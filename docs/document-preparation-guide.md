# SOFA 챗봇 문서 작성 가이드

> 이 가이드는 SOFA RAG 기반 챗봇 시스템이 최적으로 이해하고 처리할 수 있는 문서를 작성하기 위한 지침입니다.

---

## 1. 개요

### SOFA 시스템이란?

SOFA(Smart Operator's FAQ Assistant)는 RAG(Retrieval-Augmented Generation) 기반 챗봇 플랫폼입니다. 고객이 업로드한 문서를 분석하여 사용자 질문에 정확한 답변을 제공합니다.

### 문서 품질이 중요한 이유

```
문서 품질 → 청크 품질 → 검색 정확도 → 답변 품질
```

잘 구조화된 문서는:
- 더 높은 품질 점수를 받아 **자동 승인** 처리됨
- 사용자 질문과 정확하게 매칭되어 **검색 정확도** 향상
- LLM이 **더 정확하고 신뢰할 수 있는 답변** 생성

---

## 2. 시스템 동작 원리 (기술 상세)

### 2.1 문서 처리 파이프라인

```
문서 업로드 → 파싱 → 스마트 청킹 → 임베딩 생성 → 검색 인덱싱
```

### 2.2 스마트 청킹 알고리즘

업로드된 문서는 "청크(chunk)"라는 작은 단위로 분리됩니다.

| 설정 | 값 | 설명 |
|------|-----|------|
| **최대 청크 크기** | 500자 | 하나의 청크가 가질 수 있는 최대 길이 |
| **오버랩** | 50자 | 인접 청크 간 겹치는 부분 (문맥 연결성 유지) |
| **문장 경계 존중** | 활성화 | `.!?다요죠` 등 문장 끝에서 자름 |

**청킹 우선순위:**

1. **Q&A 쌍 감지** (최우선) → 각 Q&A를 독립 청크로 추출
2. **헤더 기반 분리** → Markdown `#` 또는 `===` 언더라인 헤더 기준
3. **단락 기반 분리** (기본) → 빈 줄 2개 이상으로 구분

### 2.3 Q&A 패턴 인식

시스템이 자동으로 인식하는 Q&A 패턴:

```
Q: 질문 내용
A: 답변 내용

질문: 질문 내용
답변: 답변 내용

문: 질문 내용
답: 답변 내용
```

**정규식:**
```regex
/(Q|질문|문)[:：].*\n(A|답변|답)[:：].*/
```

### 2.4 품질 점수 산정 (0-100점)

각 청크는 품질 점수를 받으며, **85점 이상이면 자동 승인**됩니다.

| 조건 | 점수 변화 | 설명 |
|------|----------|------|
| 기본값 | 100점 | 시작 점수 |
| 100자 미만 | **-20점** | 너무 짧아 문맥 부족 |
| 800자 초과 | **-10점** | 너무 길어 관련 없는 정보 포함 가능 |
| 문장 미완성 | **-15점** | `.다요죠!?`로 끝나지 않음 |
| Q만 있고 A 없음 | **-30점** | 불완전한 Q&A 쌍 |
| 의미 없는 문자 70% 초과 | **-25점** | 숫자/특수문자만 포함 |
| **Q&A 쌍** | **+10점** | 완전한 Q&A 형식 |
| **헤더 포함** | **+5점** | 명확한 주제 표시 |

**자동 승인 전략:**
- 100점 기본 → Q&A 쌍(+10) = 110점 (즉시 승인)
- 100점 기본 → 헤더 포함(+5) = 105점 (즉시 승인)
- 적정 길이(100-500자) + 완전한 문장 = 100점 (즉시 승인)

### 2.5 Hybrid Search (검색 방식)

사용자 질문이 들어오면 두 가지 방식으로 동시 검색합니다:

| 검색 방식 | 기술 | 장점 |
|----------|------|------|
| **Dense Search** | OpenAI 임베딩 (1536차원) | 의미적 유사도 파악 |
| **Sparse Search** | PostgreSQL + Nori 형태소 | 키워드 정확 매칭 |

두 결과를 **RRF(Reciprocal Rank Fusion)** 알고리즘으로 병합하여 최적의 청크를 선택합니다.

---

## 3. 권장 파일 형식

### 형식별 권장도

| 형식 | 권장도 | 장점 | 단점 |
|------|--------|------|------|
| **Markdown (.md)** | ⭐⭐⭐ | 헤더 구조 완벽 인식, 가독성 우수 | - |
| **Text (.txt)** | ⭐⭐⭐ | 단순하고 안정적, 변환 손실 없음 | 구조 표현 제한 |
| **PDF** | ⭐⭐ | 범용성 | 레이아웃 손실, 표 추출 어려움 |
| **DOCX** | ⭐⭐ | MS Word 호환 | 변환 과정에서 서식 손실 가능 |
| **CSV** | ⭐⭐ | 테이블 데이터 최적 | 서술형 텍스트 부적합 |
| **JSON** | ⭐ | 구조화 데이터 | 계층 구조 평탄화됨 |

### 권장사항

1. **Markdown(.md) 형식을 최우선으로 사용**하세요
2. PDF는 텍스트 기반 PDF만 사용 (스캔된 이미지 PDF 불가)
3. 표가 많은 경우 CSV 형식 고려

---

## 4. 핵심 원칙: Q&A 형식 활용

Q&A 형식은 **+10점 품질 가산점**을 받으며, 시스템이 최우선으로 처리합니다.

### 4.1 기본 Q&A 형식

```markdown
Q: 제품 배송은 얼마나 걸리나요?
A: 주문 후 영업일 기준 2-3일 내에 배송됩니다. 도서산간 지역은 1-2일 추가 소요될 수 있습니다.

Q: 교환/반품은 어떻게 하나요?
A: 수령 후 7일 이내 고객센터로 연락하시면 됩니다. 단, 고객 변심의 경우 반품 배송비는 고객 부담입니다.
```

### 4.2 한글 Q&A 형식

```markdown
질문: 제품 보증 기간은 얼마인가요?
답변: 모든 제품은 구매일로부터 1년간 무상 보증됩니다. 보증 기간 이후에는 유상 수리가 가능합니다.

질문: A/S 접수는 어떻게 하나요?
답변: 공식 홈페이지 또는 고객센터(1234-5678)를 통해 A/S를 접수할 수 있습니다.
```

### 4.3 Q&A 작성 시 주의사항

**올바른 예시:**
```markdown
Q: 무선 이어폰 배터리 수명은 얼마나 되나요?
A: 완충 시 최대 8시간 연속 재생이 가능합니다. 충전 케이스 사용 시 총 32시간까지 사용 가능합니다.
```

**잘못된 예시 (Q만 있고 A 없음 → -30점):**
```markdown
Q: 무선 이어폰 배터리 수명은 얼마나 되나요?

완충 시 최대 8시간 연속 재생이 가능합니다.
```

---

## 5. 문서 구조화 가이드

### 5.1 Markdown 헤더 활용

헤더를 사용하면 **+5점 품질 가산점**을 받습니다.

```markdown
# 제품명: 스마트 공기청정기 AirPure 3000

## 제품 소개

AirPure 3000은 3단계 필터 시스템을 갖춘 프리미엄 공기청정기입니다.
초미세먼지(PM2.5)를 99.97% 제거하며, 30평형 공간을 30분 내에 정화합니다.

## 주요 기능

### 3단계 필터 시스템
프리필터, 헤파필터, 탈취필터 3단계로 공기를 정화합니다.

### 스마트 센서
실시간 공기질 측정으로 자동 풍량 조절이 가능합니다.

## 구매 정보

정가 349,000원이며, 공식 온라인몰에서 할인가로 구매 가능합니다.
```

### 5.2 적정 단락 길이

**권장: 100-500자**

| 길이 | 점수 영향 | 권장 여부 |
|------|----------|----------|
| 100자 미만 | -20점 | 비권장 |
| **100-500자** | 0점 (기본) | **권장** |
| 500-800자 | 0점 | 허용 |
| 800자 초과 | -10점 | 비권장 |

### 5.3 완전한 문장으로 끝내기

**올바른 예시 (문장 끝: 다, 요, 죠, ., !, ?):**
```markdown
이 제품은 국내 최고 수준의 에너지 효율을 자랑합니다.
```

**잘못된 예시 (문장 미완성 → -15점):**
```markdown
이 제품은 국내 최고 수준의 에너지 효율을
```

---

## 6. 품질 점수 최적화 전략

### 6.1 자동 승인(85점 이상) 달성 전략

**전략 1: Q&A 형식 사용 (가장 쉬움)**
```
100점(기본) + 10점(Q&A) = 110점 → 자동 승인
```

**전략 2: 헤더 + 적정 길이**
```
100점(기본) + 5점(헤더) = 105점 → 자동 승인
```

**전략 3: 기본 준수**
```
100점(기본) + 완전한 문장 + 적정 길이 = 100점 → 자동 승인
```

### 6.2 감점 피하기

| 감점 요인 | 해결 방법 |
|----------|----------|
| 100자 미만 (-20) | 충분한 설명 추가 |
| 800자 초과 (-10) | 주제별로 단락 분리 |
| 문장 미완성 (-15) | 마침표로 끝내기 |
| 불완전 Q&A (-30) | Q와 A 쌍으로 작성 |
| 의미 없는 문자 (-25) | 숫자만 나열 지양 |

---

## 7. 실전 템플릿

### 7.1 제품 설명서 템플릿

```markdown
# [제품명]

## 제품 개요

[제품명]은 [핵심 기능/특징]을 제공하는 [제품 카테고리]입니다.
[주요 사용 대상]을 위해 설계되었으며, [핵심 가치/장점]을 제공합니다.

## 주요 특징

### [특징 1 제목]
[특징 1에 대한 상세 설명. 100자 이상으로 충분히 설명합니다.]

### [특징 2 제목]
[특징 2에 대한 상세 설명. 구체적인 수치나 사례를 포함합니다.]

### [특징 3 제목]
[특징 3에 대한 상세 설명. 사용자 혜택 중심으로 작성합니다.]

## 제품 사양

- 크기: [가로 x 세로 x 높이]
- 무게: [무게]
- 색상: [색상 옵션]
- 전원: [전원 사양]
- 보증: [보증 기간]

## 사용 방법

1. [첫 번째 단계 설명]
2. [두 번째 단계 설명]
3. [세 번째 단계 설명]

## 주의 사항

- [주의 사항 1]
- [주의 사항 2]
```

### 7.2 FAQ 템플릿

```markdown
# [제품명/서비스명] 자주 묻는 질문

## 구매 관련

Q: 제품은 어디서 구매할 수 있나요?
A: 공식 온라인몰(www.example.com) 및 전국 공식 매장에서 구매 가능합니다. 온라인 구매 시 무료 배송 혜택이 제공됩니다.

Q: 결제 수단은 어떤 것이 있나요?
A: 신용카드, 체크카드, 계좌이체, 네이버페이, 카카오페이 등 다양한 결제 수단을 지원합니다.

## 배송 관련

Q: 배송은 얼마나 걸리나요?
A: 주문 확인 후 영업일 기준 2-3일 내에 배송됩니다. 도서산간 지역은 1-2일 추가 소요될 수 있습니다.

Q: 배송 추적은 어떻게 하나요?
A: 배송 시작 시 문자로 송장번호가 발송됩니다. 해당 번호로 택배사 홈페이지에서 조회 가능합니다.

## 교환/반품

Q: 교환이나 반품은 어떻게 하나요?
A: 제품 수령 후 7일 이내 고객센터(1234-5678)로 연락하시면 됩니다. 제품 하자의 경우 배송비 무료이며, 고객 변심의 경우 반품 배송비는 고객 부담입니다.

Q: 환불은 언제 받을 수 있나요?
A: 반품 제품 확인 후 영업일 기준 3-5일 내에 결제 수단에 따라 환불 처리됩니다.

## A/S 관련

Q: 보증 기간은 얼마인가요?
A: 구매일로부터 1년간 무상 보증이 제공됩니다. 보증 기간 이후에는 유상 수리가 가능합니다.

Q: A/S 접수는 어떻게 하나요?
A: 고객센터(1234-5678) 또는 공식 홈페이지 내 A/S 접수 페이지에서 신청 가능합니다.
```

### 7.3 사용 가이드 템플릿

```markdown
# [제품명] 사용 가이드

## 시작하기

### 패키지 내용물 확인
제품 박스에는 다음 품목이 포함되어 있습니다. 개봉 후 모든 품목이 있는지 확인해주세요.
- [본체]
- [부속품 1]
- [부속품 2]
- [사용설명서]
- [보증서]

### 초기 설정

1단계: [초기 설정 첫 번째 과정에 대한 상세 설명]

2단계: [초기 설정 두 번째 과정에 대한 상세 설명]

3단계: [초기 설정 세 번째 과정에 대한 상세 설명]

## 기본 사용법

### [기능 1] 사용하기
[기능 1]을 사용하려면 [구체적인 조작 방법]을 따르세요. 이 기능을 통해 [얻을 수 있는 결과/혜택]을 경험할 수 있습니다.

### [기능 2] 사용하기
[기능 2]는 [사용 상황/목적]에 유용합니다. [버튼/메뉴]를 [조작 방법]하여 사용하세요.

## 문제 해결

### [문제 상황 1]
증상: [문제 증상 설명]
해결 방법: [해결 방법 상세 설명]

### [문제 상황 2]
증상: [문제 증상 설명]
해결 방법: [해결 방법 상세 설명]

## 관리 및 유지보수

제품을 오래 사용하기 위해 다음 관리 방법을 준수해주세요.
- [관리 방법 1]
- [관리 방법 2]
- [관리 방법 3]
```

### 7.4 구매 요령 템플릿

```markdown
# [제품 카테고리] 구매 가이드

## 구매 전 체크리스트

### 1. 용도 확인
[제품]을 선택하기 전에 사용 목적을 명확히 해야 합니다. [용도 A]용으로는 [특징 A]가 중요하고, [용도 B]용으로는 [특징 B]를 우선 고려하세요.

### 2. 공간/환경 확인
설치할 공간의 크기와 환경을 미리 확인하세요. [면적/크기]에 따라 적합한 [사양]이 달라집니다.

### 3. 예산 설정
[가격대별 특징 설명]. 초기 비용뿐 아니라 유지비용도 함께 고려하세요.

## 제품 비교 포인트

### [비교 포인트 1]
[비교 포인트 1]은 [성능/기능]에 직접적인 영향을 미칩니다. [구체적인 비교 기준]을 확인하세요.

### [비교 포인트 2]
[비교 포인트 2]는 [장기적인 관점]에서 중요합니다. [확인해야 할 사항]을 체크하세요.

### [비교 포인트 3]
[비교 포인트 3]은 [편의성/실용성]과 관련됩니다. 실제 사용 시나리오를 고려하여 선택하세요.

## 구매 시 확인사항

- 정품 인증 여부
- 보증 기간 및 A/S 정책
- 배송 및 설치 서비스
- 반품/교환 조건

## 추천 제품 선택 기준

### 예산별 추천
- [저가형]: [특징 및 추천 대상]
- [중간가]: [특징 및 추천 대상]
- [고급형]: [특징 및 추천 대상]

### 용도별 추천
- [용도 A]용: [추천 사양 및 이유]
- [용도 B]용: [추천 사양 및 이유]
```

---

## 8. 피해야 할 패턴

### 8.1 너무 짧은 단락 (-20점)

**잘못된 예시:**
```markdown
배송 안내

빠른 배송
```

**올바른 예시:**
```markdown
## 배송 안내

주문 확인 후 영업일 기준 2-3일 내에 배송됩니다. 무료 배송 조건은 3만원 이상 구매 시 적용되며, 도서산간 지역은 추가 배송비가 발생할 수 있습니다.
```

### 8.2 너무 긴 단락 (-10점)

**잘못된 예시:**
```markdown
(800자 이상의 끊김 없는 긴 텍스트...)
```

**올바른 예시:**
```markdown
(주제별로 200-400자 단위로 분리)
```

### 8.3 불완전한 Q&A (-30점)

**잘못된 예시:**
```markdown
Q: 배송은 얼마나 걸리나요?

배송은 2-3일 소요됩니다.  ← A: 가 없음!
```

**올바른 예시:**
```markdown
Q: 배송은 얼마나 걸리나요?
A: 배송은 영업일 기준 2-3일 소요됩니다.
```

### 8.4 테이블만 있는 문서

**잘못된 예시:**
```markdown
| 제품 | 가격 | 용량 |
|------|------|------|
| A형 | 10,000 | 100ml |
| B형 | 20,000 | 200ml |
```

**올바른 예시:**
```markdown
## 제품 라인업

당사는 다양한 용량의 제품을 제공합니다. 사용량에 따라 적합한 제품을 선택하세요.

| 제품 | 가격 | 용량 | 추천 대상 |
|------|------|------|----------|
| A형 | 10,000원 | 100ml | 1인 가구, 휴대용 |
| B형 | 20,000원 | 200ml | 2-3인 가구, 일반 사용 |

A형은 휴대가 간편하여 여행이나 출장 시 유용하며, B형은 가정에서 일상적으로 사용하기에 적합합니다.
```

### 8.5 이미지 텍스트 의존

PDF 내 이미지로 된 텍스트는 추출되지 않습니다. 모든 정보는 텍스트로 작성해주세요.

---

## 9. 업로드 전 체크리스트

문서 업로드 전 다음 항목을 확인하세요:

### 파일 형식
- [ ] Markdown(.md) 또는 Text(.txt) 형식 사용
- [ ] PDF의 경우 텍스트 기반인지 확인 (스캔 이미지 아님)

### 문서 구조
- [ ] 명확한 헤더(#, ##, ###)로 섹션 구분
- [ ] 각 단락이 100-500자 범위 내
- [ ] 완전한 문장으로 끝남 (마침표, 다, 요, 죠 등)

### Q&A 형식 (해당 시)
- [ ] `Q:` 다음에 반드시 `A:` 존재
- [ ] 각 Q&A 쌍이 완결된 내용

### 내용 품질
- [ ] 숫자/특수문자만 나열된 부분 없음
- [ ] 중요한 정보가 이미지가 아닌 텍스트로 작성됨
- [ ] 주제별로 논리적으로 구조화됨

---

## 부록: 품질 점수 계산기

예상 품질 점수를 계산해보세요:

```
기본 점수: 100점

감점 항목 (해당 시 체크):
[ ] 100자 미만 → -20점
[ ] 800자 초과 → -10점
[ ] 문장 미완성 → -15점
[ ] Q만 있고 A 없음 → -30점
[ ] 의미 없는 문자 70% 초과 → -25점

가산점 항목 (해당 시 체크):
[ ] Q&A 쌍 → +10점
[ ] 헤더 포함 → +5점

예상 점수: ___점 (85점 이상이면 자동 승인)
```

---

## 문의

문서 작성에 대한 추가 질문이 있으시면 담당자에게 연락해주세요.

---

*이 가이드는 SOFA 시스템 v1.0 기준으로 작성되었습니다.*
