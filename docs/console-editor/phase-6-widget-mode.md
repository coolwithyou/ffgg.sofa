# Phase 6: Widget Mode - ìœ„ì ¯ ì»¤ìŠ¤í„°ë§ˆì´ì§• (í›„ì†)

> MVP ì™„ë£Œ í›„ ì§„í–‰ë˜ëŠ” í›„ì† ì‘ì—…ì…ë‹ˆë‹¤. iframe ìœ„ì ¯ì˜ ì»¤ìŠ¤í„°ë§ˆì´ì§• ê¸°ëŠ¥ì„ Console Editorì— í†µí•©í•©ë‹ˆë‹¤.

## ê°œìš”

### ëª©í‘œ
- Widget í¸ì§‘ ëª¨ë“œ ì¶”ê°€ (Page ëª¨ë“œì™€ ì „í™˜)
- Widget í”„ë¦¬ë·° (iframe ì‹œë®¬ë ˆì´ì…˜)
- Widget ì„ë² ë“œ ì½”ë“œ ìƒì„± ë° ë³µì‚¬
- Widget ì„¤ì • ì €ì¥ ë° ìë™ ì €ì¥

### ì˜ì¡´ì„±
- **Phase 1-5**: ëª¨ë“  MVP ê¸°ëŠ¥ ì™„ë£Œ í›„ ì§„í–‰

### MVP í¬í•¨ ì—¬ë¶€
- **MVPì— ë¯¸í¬í•¨** (í›„ì† êµ¬í˜„)

---

## ì „ì²´ ë§¥ë½ì—ì„œì˜ ì—­í• 

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Phase 6: Widget Mode í†µí•©                       â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚               Left Sidebar (Phase 1 í™•ì¥)                   â”‚ â”‚
â”‚  â”‚                                                             â”‚ â”‚
â”‚  â”‚   [Page] [Widget] â† ëª¨ë“œ íƒ­ (Phase 6ì—ì„œ Widget í™œì„±í™”)     â”‚ â”‚
â”‚  â”‚                                                             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              Center Preview (Widget ëª¨ë“œ)                   â”‚ â”‚
â”‚  â”‚                                                             â”‚ â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚   â”‚            Widget Preview Frame                      â”‚  â”‚ â”‚
â”‚  â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”‚
â”‚  â”‚   â”‚   â”‚  ğŸ¤– ì±„íŒ… ë²„íŠ¼                                   â”‚ â”‚  â”‚ â”‚
â”‚  â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â”‚
â”‚  â”‚   â”‚                  OR                                  â”‚  â”‚ â”‚
â”‚  â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”‚
â”‚  â”‚   â”‚   â”‚  ğŸ’¬ ì±„íŒ…ì°½ (í™•ì¥ ìƒíƒœ)                          â”‚ â”‚  â”‚ â”‚
â”‚  â”‚   â”‚   â”‚     Header + Messages + Input                   â”‚ â”‚  â”‚ â”‚
â”‚  â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚                                                             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              Right Settings (Widget ì „ìš©)                   â”‚ â”‚
â”‚  â”‚                                                             â”‚ â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚   â”‚  ë²„íŠ¼ ì„¤ì •                                           â”‚  â”‚ â”‚
â”‚  â”‚   â”‚  - ë²„íŠ¼ ì•„ì´ì½˜                                       â”‚  â”‚ â”‚
â”‚  â”‚   â”‚  - ë²„íŠ¼ ìœ„ì¹˜ (ì¢Œ/ìš° í•˜ë‹¨)                            â”‚  â”‚ â”‚
â”‚  â”‚   â”‚  - ë²„íŠ¼ ìƒ‰ìƒ                                         â”‚  â”‚ â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚   â”‚  ì±„íŒ…ì°½ ì„¤ì •                                         â”‚  â”‚ â”‚
â”‚  â”‚   â”‚  - í—¤ë” í…ìŠ¤íŠ¸                                       â”‚  â”‚ â”‚
â”‚  â”‚   â”‚  - ì±„íŒ…ì°½ í¬ê¸°                                       â”‚  â”‚ â”‚
â”‚  â”‚   â”‚  - í…Œë§ˆ ìƒ‰ìƒ                                         â”‚  â”‚ â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚   â”‚  ì„ë² ë“œ ì½”ë“œ                                         â”‚  â”‚ â”‚
â”‚  â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚ â”‚
â”‚  â”‚   â”‚  â”‚ <script src="..."></script>                   â”‚  â”‚  â”‚ â”‚
â”‚  â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚ â”‚
â”‚  â”‚   â”‚  [ì½”ë“œ ë³µì‚¬]                                        â”‚  â”‚ â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚                                                             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ê³„íšëœ êµ¬í˜„ ìƒì„¸

### 1. Widget ì„¤ì • íƒ€ì…

```typescript
// app/(console)/console/types.ts ì— ì¶”ê°€

interface WidgetConfig {
  // ë²„íŠ¼ ì„¤ì •
  button: {
    icon: 'chat' | 'question' | 'custom';
    customIconUrl?: string;
    position: 'bottom-right' | 'bottom-left';
    size: 'small' | 'medium' | 'large';
    color: string;
  };

  // ì±„íŒ…ì°½ ì„¤ì •
  chatWindow: {
    width: number;  // 360-500px
    height: number; // 400-700px
    headerText: string;
    welcomeMessage: string;
    placeholder: string;
  };

  // í…Œë§ˆ ì„¤ì •
  theme: {
    primaryColor: string;
    backgroundColor: string;
    textColor: string;
    borderRadius: 'none' | 'small' | 'medium' | 'large';
  };

  // ë™ì‘ ì„¤ì •
  behavior: {
    autoOpen: boolean;
    autoOpenDelay: number; // ms
    showOnMobile: boolean;
  };
}

const DEFAULT_WIDGET_CONFIG: WidgetConfig = {
  button: {
    icon: 'chat',
    position: 'bottom-right',
    size: 'medium',
    color: '#6366F1', // Indigo
  },
  chatWindow: {
    width: 400,
    height: 600,
    headerText: 'ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?',
    welcomeMessage: 'ì•ˆë…•í•˜ì„¸ìš”! ê¶ê¸ˆí•œ ì ì´ ìˆìœ¼ì‹œë©´ ì§ˆë¬¸í•´ì£¼ì„¸ìš”.',
    placeholder: 'ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”...',
  },
  theme: {
    primaryColor: '#6366F1',
    backgroundColor: '#FFFFFF',
    textColor: '#1F2937',
    borderRadius: 'medium',
  },
  behavior: {
    autoOpen: false,
    autoOpenDelay: 3000,
    showOnMobile: true,
  },
};
```

---

### 2. Widget í”„ë¦¬ë·° ì»´í¬ë„ŒíŠ¸

```typescript
// app/(console)/console/components/widget-preview.tsx

'use client';

import { useWidgetConfig } from '../hooks/use-console-state';

/**
 * Widget í”„ë¦¬ë·°
 *
 * Page ëª¨ë“œì˜ DeviceFrame ëŒ€ì‹  ì‚¬ìš©
 * Widgetì´ ì‹¤ì œ ì›¹í˜ì´ì§€ì— ì‚½ì…ëœ ëª¨ìŠµì„ ì‹œë®¬ë ˆì´ì…˜
 */
export function WidgetPreview() {
  const { widgetConfig } = useWidgetConfig();

  return (
    <div className="relative h-[500px] w-[800px] rounded-lg border border-border bg-muted/30">
      {/* ê°€ìƒ ì›¹í˜ì´ì§€ ë°°ê²½ */}
      <div className="absolute inset-0 p-8">
        <div className="h-full w-full rounded bg-card/50 p-4">
          <div className="h-4 w-32 rounded bg-muted" />
          <div className="mt-4 h-3 w-48 rounded bg-muted/70" />
          <div className="mt-2 h-3 w-40 rounded bg-muted/70" />
        </div>
      </div>

      {/* Widget ë²„íŠ¼ */}
      <WidgetButton config={widgetConfig.button} />

      {/* Widget ì±„íŒ…ì°½ (í”„ë¦¬ë·°ìš©) */}
      <WidgetChatWindow config={widgetConfig} />
    </div>
  );
}
```

---

### 3. Widget ì„¤ì • íŒ¨ë„

```typescript
// app/(console)/console/components/settings/widget-button-settings.tsx
// app/(console)/console/components/settings/widget-chat-settings.tsx
// app/(console)/console/components/settings/widget-theme-settings.tsx
// app/(console)/console/components/settings/embed-code-settings.tsx
```

í•µì‹¬ ì„¤ì • í•­ëª©:
- **ë²„íŠ¼ ì„¤ì •**: ì•„ì´ì½˜, ìœ„ì¹˜, í¬ê¸°, ìƒ‰ìƒ
- **ì±„íŒ…ì°½ ì„¤ì •**: í¬ê¸°, í—¤ë” í…ìŠ¤íŠ¸, í™˜ì˜ ë©”ì‹œì§€
- **í…Œë§ˆ ì„¤ì •**: ìƒ‰ìƒ, ë‘¥ê¸€ê¸°
- **ì„ë² ë“œ ì½”ë“œ**: ìƒì„± ë° ë³µì‚¬

---

### 4. ì„ë² ë“œ ì½”ë“œ ìƒì„±

```typescript
// app/(console)/console/components/settings/embed-code-settings.tsx

function generateEmbedCode(chatbotId: string, config: WidgetConfig): string {
  const baseUrl = process.env.NEXT_PUBLIC_WIDGET_URL || 'https://widget.sofa.ai';

  return `<!-- SOFA Widget -->
<script>
  (function(s,o,f,a){
    s.sofaWidget=s.sofaWidget||[];
    var script=o.createElement('script');
    script.async=true;
    script.src='${baseUrl}/widget.js';
    script.dataset.chatbotId='${chatbotId}';
    script.dataset.position='${config.button.position}';
    o.head.appendChild(script);
  })(window,document);
</script>`;
}
```

---

### 5. Mode ì „í™˜ ë¡œì§

```typescript
// ConsoleContext í™•ì¥

const setMode = useCallback((mode: 'page' | 'widget') => {
  // í˜„ì¬ ëª¨ë“œì˜ ë³€ê²½ì‚¬í•­ ì €ì¥
  if (saveStatus === 'unsaved') {
    saveNow();
  }

  // ëª¨ë“œ ì „í™˜
  setCurrentMode(mode);

  // í•´ë‹¹ ëª¨ë“œì˜ ì„¤ì • ë¡œë“œ
  if (mode === 'widget' && currentChatbot) {
    loadWidgetConfig(currentChatbot.id);
  }
}, [saveStatus, saveNow, currentChatbot]);
```

---

## API ì—”ë“œí¬ì¸íŠ¸ (ì‹ ê·œ í•„ìš”)

### Widget ì„¤ì • ì¡°íšŒ/ì €ì¥
```
GET /api/chatbots/[id]/widget
Response: { config: WidgetConfig }

PATCH /api/chatbots/[id]/widget
Body: { config: Partial<WidgetConfig> }
Response: { config: WidgetConfig }
```

### Widget ë°œí–‰
```
POST /api/chatbots/[id]/widget/publish
Response: { success: true, embedCode: string }
```

---

## ì™„ë£Œ ì²´í¬ë¦¬ìŠ¤íŠ¸ (í›„ì† ì‘ì—… ì‹œ)

### í•„ìˆ˜
- [ ] WidgetConfig íƒ€ì… ì •ì˜
- [ ] ConsoleContextì— widgetConfig ìƒíƒœ ì¶”ê°€
- [ ] WidgetPreview ì»´í¬ë„ŒíŠ¸ êµ¬í˜„
- [ ] Widget ì „ìš© ì„¤ì • íŒ¨ë„ êµ¬í˜„
- [ ] ì„ë² ë“œ ì½”ë“œ ìƒì„± ë° ë³µì‚¬ ê¸°ëŠ¥
- [ ] Widget API ì—”ë“œí¬ì¸íŠ¸ êµ¬í˜„

### ê²€ì¦
- [ ] Page â†” Widget ëª¨ë“œ ì „í™˜
- [ ] Widget í”„ë¦¬ë·° ì‹¤ì‹œê°„ ë°˜ì˜
- [ ] ì„ë² ë“œ ì½”ë“œ ë³µì‚¬ ë™ì‘
- [ ] Widget ìë™ ì €ì¥ ë™ì‘
- [ ] Widget ë°œí–‰ ë™ì‘

---

## ìš°ì„ ìˆœìœ„ ë° ì¼ì •

### ìš°ì„ ìˆœìœ„
1. Widget ì„¤ì • ì €ì¥/ë¡œë“œ (ê¸°ë³¸ ê¸°ëŠ¥)
2. Widget í”„ë¦¬ë·° (ì‹œê°ì  í”¼ë“œë°±)
3. ì„ë² ë“œ ì½”ë“œ ìƒì„± (í•µì‹¬ ê°€ì¹˜)
4. ê³ ê¸‰ ì„¤ì • (ìë™ ì—´ë¦¼, ëª¨ë°”ì¼ ì„¤ì • ë“±)

### ì˜ˆìƒ ì‘ì—…ëŸ‰
- Widget íƒ€ì… ë° Context í™•ì¥: ì¤‘
- Widget í”„ë¦¬ë·° ì»´í¬ë„ŒíŠ¸: ì¤‘
- Widget ì„¤ì • íŒ¨ë„: ì¤‘
- ì„ë² ë“œ ì½”ë“œ ìƒì„±: ì†Œ
- API ì—”ë“œí¬ì¸íŠ¸: ì¤‘

---

## ê´€ë ¨ ë¬¸ì„œ

- [Widget ì‹œìŠ¤í…œ ë¬¸ì„œ](/docs/widget/README.md) (ìˆëŠ” ê²½ìš°)
- [Public Page ë¬¸ì„œ](/docs/public-page/README.md)

---

## ì°¸ê³ ì‚¬í•­

Widget ëª¨ë“œëŠ” Page ëª¨ë“œ MVP ì™„ë£Œ í›„ ì‚¬ìš©ì í”¼ë“œë°±ì„ ë°˜ì˜í•˜ì—¬ ì„¤ê³„ë¥¼ ì¡°ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í˜„ì¬ ë¬¸ì„œëŠ” ì´ˆê¸° ê³„íšì´ë©°, ì‹¤ì œ êµ¬í˜„ ì‹œ ë³€ê²½ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
