# RAG í‰ê°€ ì‹œìŠ¤í…œ

SOFAì˜ RAG(Retrieval-Augmented Generation) íŒŒì´í”„ë¼ì¸ í’ˆì§ˆì„ ì •ëŸ‰ì ìœ¼ë¡œ ì¸¡ì •í•˜ê³  ê°œì„ ì ì„ íŒŒì•…í•˜ê¸° ìœ„í•œ í‰ê°€ ì‹œìŠ¤í…œì…ë‹ˆë‹¤.

## ê°œìš”

ì´ í‰ê°€ ì‹œìŠ¤í…œì€ **RAGAS(Retrieval-Augmented Generation Assessment)** ìŠ¤íƒ€ì¼ì˜ ë©”íŠ¸ë¦­ì„ ì‚¬ìš©í•˜ì—¬ ì±—ë´‡ ì‘ë‹µ í’ˆì§ˆì„ í‰ê°€í•©ë‹ˆë‹¤.

### í•µì‹¬ íŠ¹ì§•

- **LLM-as-Judge**: LLMì„ í™œìš©í•œ ìë™ í‰ê°€
- **4ê°€ì§€ í•µì‹¬ ë©”íŠ¸ë¦­**: Faithfulness, Answer Relevancy, Context Precision, Context Recall
- **Query Rewriting íš¨ê³¼ ì¸¡ì •**: í›„ì† ì§ˆë¬¸ì— ëŒ€í•œ ì¿¼ë¦¬ ì¬ì‘ì„± íš¨ê³¼ ë¶„ì„
- **CLI ë„êµ¬ ì œê³µ**: ê°„í¸í•œ ì»¤ë§¨ë“œë¼ì¸ í‰ê°€ ì‹¤í–‰

---

## ë¹ ë¥¸ ì‹œì‘

### ê¸°ë³¸ í‰ê°€ ì‹¤í–‰

```bash
# ìƒ˜í”Œ ë°ì´í„°ì…‹ìœ¼ë¡œ í‰ê°€
pnpm rag:evaluate --dataset data/evaluation/sample-dataset.json

# ê²°ê³¼ë¥¼ JSONìœ¼ë¡œ ì €ì¥
pnpm rag:evaluate -d data/evaluation/sample-dataset.json -o results/report.json

# ë§ˆí¬ë‹¤ìš´ ë¦¬í¬íŠ¸ë„ í•¨ê»˜ ìƒì„±
pnpm rag:evaluate -d sample.json -o results/report.json --markdown
```

### CLI ì˜µì…˜

| ì˜µì…˜ | ì„¤ëª… | ê¸°ë³¸ê°’ |
|------|------|--------|
| `-d, --dataset <path>` | í‰ê°€ ë°ì´í„°ì…‹ JSON íŒŒì¼ ê²½ë¡œ | (í•„ìˆ˜) |
| `-o, --output <path>` | ê²°ê³¼ ë¦¬í¬íŠ¸ ì €ì¥ ê²½ë¡œ | - |
| `-m, --metrics <list>` | í‰ê°€ ë©”íŠ¸ë¦­ (ì‰¼í‘œ êµ¬ë¶„) | ì „ì²´ |
| `-c, --concurrency <n>` | ë³‘ë ¬ ì²˜ë¦¬ ê°œìˆ˜ | 3 |
| `--max-chunks <n>` | ê²€ìƒ‰ ì²­í¬ ìˆ˜ | 5 |
| `--markdown` | ë§ˆí¬ë‹¤ìš´ ë¦¬í¬íŠ¸ ìƒì„± | false |
| `-v, --verbose` | ìƒì„¸ ê²°ê³¼ ì¶œë ¥ | false |
| `-h, --help` | ë„ì›€ë§ í‘œì‹œ | - |

---

## í‰ê°€ ë©”íŠ¸ë¦­

### 1. Faithfulness (ì¶©ì‹¤ë„)

**ì •ì˜**: ìƒì„±ëœ ë‹µë³€ì´ ê²€ìƒ‰ëœ ì»¨í…ìŠ¤íŠ¸ì— ì–¼ë§ˆë‚˜ ì¶©ì‹¤í•œê°€

**ì¸¡ì • ë°©ë²•**:
1. ë‹µë³€ì—ì„œ ì‚¬ì‹¤ì  ì£¼ì¥(claims)ì„ ì¶”ì¶œ
2. ê° ì£¼ì¥ì´ ì»¨í…ìŠ¤íŠ¸ì—ì„œ ì§€ì§€ë˜ëŠ”ì§€ ê²€ì¦
3. ì ìˆ˜ = ì§€ì§€ë˜ëŠ” ì£¼ì¥ ìˆ˜ / ì „ì²´ ì£¼ì¥ ìˆ˜

**ì ìˆ˜ í•´ì„**:
- `1.0`: ëª¨ë“  ì£¼ì¥ì´ ì»¨í…ìŠ¤íŠ¸ì— ê·¼ê±°í•¨
- `0.5`: ì ˆë°˜ì˜ ì£¼ì¥ë§Œ ê·¼ê±° ìˆìŒ
- `0.0`: í• ë£¨ì‹œë„¤ì´ì…˜ - ëª¨ë“  ì£¼ì¥ì´ ê·¼ê±° ì—†ìŒ

**ì˜ˆì‹œ**:
```
ì§ˆë¬¸: "í™˜ë¶ˆ ì •ì±…ì€ ë¬´ì—‡ì¸ê°€ìš”?"
ì»¨í…ìŠ¤íŠ¸: "êµ¬ë§¤ í›„ 7ì¼ ì´ë‚´ ë¯¸ê°œë´‰ ìƒí’ˆì— í•œí•´ í™˜ë¶ˆ ê°€ëŠ¥"
ë‹µë³€: "êµ¬ë§¤ í›„ 7ì¼ ì´ë‚´ì— í™˜ë¶ˆ ê°€ëŠ¥í•˜ë©°, 30ì¼ ì´ë‚´ì—ë„ ë¶€ë¶„ í™˜ë¶ˆë©ë‹ˆë‹¤."

ì£¼ì¥ 1: "7ì¼ ì´ë‚´ í™˜ë¶ˆ ê°€ëŠ¥" â†’ ì§€ì§€ë¨ âœ“
ì£¼ì¥ 2: "30ì¼ ì´ë‚´ ë¶€ë¶„ í™˜ë¶ˆ" â†’ ì§€ì§€ ì•ˆë¨ âœ—

Faithfulness = 1/2 = 0.5
```

### 2. Answer Relevancy (ë‹µë³€ ê´€ë ¨ì„±)

**ì •ì˜**: ë‹µë³€ì´ ì§ˆë¬¸ì— ì–¼ë§ˆë‚˜ ì ì ˆí•˜ê²Œ ì‘ë‹µí•˜ëŠ”ê°€

**ì¸¡ì • ë°©ë²•**:
- LLMì´ ì§ˆë¬¸-ë‹µë³€ ìŒì„ ì§ì ‘ í‰ê°€
- ì§ˆë¬¸ì˜ ì˜ë„ë¥¼ ì–¼ë§ˆë‚˜ ì˜ íŒŒì•…í–ˆëŠ”ì§€ ë¶„ì„
- ë¶ˆí•„ìš”í•œ ì •ë³´ê°€ í¬í•¨ë˜ì—ˆëŠ”ì§€ í™•ì¸

**ì ìˆ˜ í•´ì„**:
- `1.0`: ì§ˆë¬¸ì— ì™„ë²½í•˜ê²Œ ë‹µë³€
- `0.7`: ëŒ€ë¶€ë¶„ ë‹µë³€í•˜ì§€ë§Œ ì¼ë¶€ ëˆ„ë½
- `0.3`: ê´€ë ¨ì€ ìˆì§€ë§Œ í•µì‹¬ì„ ë†“ì¹¨
- `0.0`: ì™„ì „íˆ ê´€ë ¨ ì—†ëŠ” ë‹µë³€

### 3. Context Precision (ì»¨í…ìŠ¤íŠ¸ ì •í™•ë„)

**ì •ì˜**: ê²€ìƒ‰ëœ ì²­í¬ ì¤‘ ì‹¤ì œë¡œ ìœ ìš©í•œ ì •ë³´ì˜ ë¹„ìœ¨

**ì¸¡ì • ë°©ë²•**:
1. ê° ê²€ìƒ‰ëœ ì²­í¬ì˜ ê´€ë ¨ì„±ì„ í‰ê°€
2. Precision@K ê³„ì‚° (K = 1, 3, 5)
3. ê°€ì¤‘ í‰ê· : P@1Ã—0.5 + P@3Ã—0.3 + P@5Ã—0.2

**ì ìˆ˜ í•´ì„**:
- `1.0`: ëª¨ë“  ê²€ìƒ‰ ê²°ê³¼ê°€ ê´€ë ¨ ìˆìŒ
- `0.7`: ìƒìœ„ ê²°ê³¼ëŠ” ì¢‹ì§€ë§Œ í•˜ìœ„ì— ë…¸ì´ì¦ˆ
- `0.3`: ê´€ë ¨ ì—†ëŠ” ì²­í¬ê°€ ë” ë§ìŒ

**ì˜ˆì‹œ**:
```
ê²€ìƒ‰ ê²°ê³¼ (5ê°œ):
1. í™˜ë¶ˆ ì •ì±… ë¬¸ì„œ âœ“ (ê´€ë ¨)
2. ë°°ì†¡ ì•ˆë‚´ ë¬¸ì„œ âœ— (ë¬´ê´€)
3. êµí™˜ ì •ì±… ë¬¸ì„œ âœ“ (ê´€ë ¨)
4. íšŒì‚¬ ì†Œê°œ âœ— (ë¬´ê´€)
5. FAQ ë¬¸ì„œ âœ“ (ê´€ë ¨)

P@1 = 1/1 = 1.0
P@3 = 2/3 = 0.67
P@5 = 3/5 = 0.6

Context Precision = 1.0Ã—0.5 + 0.67Ã—0.3 + 0.6Ã—0.2 = 0.82
```

### 4. Context Recall (ì»¨í…ìŠ¤íŠ¸ ì¬í˜„ìœ¨)

**ì •ì˜**: ë‹µë³€ì— í•„ìš”í•œ ì •ë³´ê°€ ê²€ìƒ‰ëœ ì»¨í…ìŠ¤íŠ¸ì— ì–¼ë§ˆë‚˜ í¬í•¨ë˜ì–´ ìˆëŠ”ê°€

**ì¸¡ì • ë°©ë²•**:
- Ground Truth ì²­í¬ê°€ ìˆëŠ” ê²½ìš°: ì§ì ‘ ë¹„êµ
- ì—†ëŠ” ê²½ìš°: LLMì´ í•„ìš” ì •ë³´ vs ê²€ìƒ‰ ì •ë³´ ë¹„êµ

**ì ìˆ˜ í•´ì„**:
- `1.0`: í•„ìš”í•œ ëª¨ë“  ì •ë³´ë¥¼ ê²€ìƒ‰í•¨
- `0.5`: ì ˆë°˜ì˜ ì •ë³´ë§Œ ê²€ìƒ‰ë¨
- `0.0`: í•„ìš”í•œ ì •ë³´ë¥¼ ì „í˜€ ëª» ì°¾ìŒ

---

## í‰ê°€ ë°ì´í„°ì…‹ êµ¬ì¡°

### ê¸°ë³¸ í˜•ì‹

```json
{
  "version": "1.0.0",
  "name": "ë°ì´í„°ì…‹ ì´ë¦„",
  "description": "ì„¤ëª…",
  "tenantId": "í…Œë„ŒíŠ¸ ID",
  "datasetIds": ["ë¬¸ì„œì…‹ ID"],
  "items": [
    {
      "id": "unique-id",
      "question": "ì§ˆë¬¸",
      "questionType": "factual",
      "groundTruth": "ê¸°ëŒ€í•˜ëŠ” ì •ë‹µ"
    }
  ],
  "createdAt": "2025-01-01T00:00:00Z",
  "updatedAt": "2025-01-01T00:00:00Z"
}
```

### ì§ˆë¬¸ ìœ í˜• (questionType)

| ìœ í˜• | ì„¤ëª… | ì˜ˆì‹œ |
|------|------|------|
| `factual` | ì‚¬ì‹¤ í™•ì¸ ì§ˆë¬¸ | "í™˜ë¶ˆ ê¸°í•œì€?" |
| `followup` | í›„ì† ì§ˆë¬¸ (Query Rewriting í…ŒìŠ¤íŠ¸) | "ê·¸ëŸ¬ë©´ ê°œë´‰í•œ ê²½ìš°ëŠ”?" |
| `comparison` | ë¹„êµ ì§ˆë¬¸ | "Aì™€ Bì˜ ì°¨ì´ì ì€?" |
| `procedural` | ì ˆì°¨/ë°©ë²• ì§ˆë¬¸ | "íšŒì›ê°€ì… ë°©ë²•ì€?" |
| `reasoning` | ì¶”ë¡  í•„ìš” ì§ˆë¬¸ | "ì™œ í™˜ë¶ˆì´ ê±°ë¶€ë˜ì—ˆì„ê¹Œìš”?" |
| `unanswerable` | ë‹µë³€ ë¶ˆê°€ (í• ë£¨ì‹œë„¤ì´ì…˜ í…ŒìŠ¤íŠ¸) | "ë‚´ì¼ ë‚ ì”¨ëŠ”?" |

### í›„ì† ì§ˆë¬¸ ì˜ˆì‹œ

```json
{
  "id": "followup-001",
  "question": "ê·¸ëŸ¬ë©´ ê°œë´‰í•œ ê²½ìš°ëŠ”ìš”?",
  "questionType": "followup",
  "groundTruth": "ê°œë´‰í•œ ìƒí’ˆì€ ê²°í•¨ ì‹œì—ë§Œ êµí™˜/í™˜ë¶ˆ ê°€ëŠ¥",
  "conversationHistory": [
    {
      "role": "user",
      "content": "í™˜ë¶ˆ ì •ì±…ì€ ë¬´ì—‡ì¸ê°€ìš”?"
    },
    {
      "role": "assistant",
      "content": "êµ¬ë§¤ í›„ 7ì¼ ì´ë‚´ ë¯¸ê°œë´‰ ìƒí’ˆì€ ì „ì•¡ í™˜ë¶ˆ ê°€ëŠ¥í•©ë‹ˆë‹¤."
    }
  ]
}
```

---

## í”„ë¡œê·¸ë˜ë§¤í‹± ì‚¬ìš©

### ê¸°ë³¸ ì‚¬ìš©

```typescript
import {
  loadDataset,
  RagEvaluator,
  printSummary
} from '@/lib/rag/evaluation';

// ë°ì´í„°ì…‹ ë¡œë“œ
const dataset = await loadDataset('data/evaluation/my-dataset.json');

// í‰ê°€ ì‹¤í–‰
const evaluator = new RagEvaluator({
  metrics: ['faithfulness', 'answerRelevancy'],
  concurrency: 5,
  onProgress: (current, total) => {
    console.log(`ì§„í–‰: ${current}/${total}`);
  },
});

const report = await evaluator.evaluate(dataset);

// ê²°ê³¼ ì¶œë ¥
printSummary(report);
```

### ê°œë³„ ë©”íŠ¸ë¦­ ì‚¬ìš©

```typescript
import {
  evaluateFaithfulness,
  evaluateAnswerRelevancy,
  evaluateContextPrecision,
  evaluateContextRecall,
} from '@/lib/rag/evaluation';

// Faithfulness í‰ê°€
const faithResult = await evaluateFaithfulness(
  "ìƒì„±ëœ ë‹µë³€",
  "ê²€ìƒ‰ëœ ì»¨í…ìŠ¤íŠ¸ ë‚´ìš©"
);
console.log(`Faithfulness: ${faithResult.score}`);
console.log(`ë¶„ì„:`, faithResult.analysis.claims);

// Answer Relevancy í‰ê°€
const relevancyResult = await evaluateAnswerRelevancy(
  "ì§ˆë¬¸",
  "ìƒì„±ëœ ë‹µë³€"
);
console.log(`Answer Relevancy: ${relevancyResult.score}`);
```

### ë¦¬í¬íŠ¸ ìƒì„±

```typescript
import {
  generateReportFile,
  generateMarkdownReport
} from '@/lib/rag/evaluation';

// JSON íŒŒì¼ë¡œ ì €ì¥
await generateReportFile(report, 'results/report.json');

// ë§ˆí¬ë‹¤ìš´ ìƒì„±
const markdown = generateMarkdownReport(report);
await writeFile('results/report.md', markdown);
```

---

## ê²°ê³¼ í•´ì„

### ì½˜ì†” ì¶œë ¥ ì˜ˆì‹œ

```
ğŸ“Š í‰ê°€ ê²°ê³¼ ìš”ì•½
================================================================================
ë°ì´í„°ì…‹: SOFA ê¸°ë³¸ í‰ê°€ ì„¸íŠ¸ (v1.0.0)
í‰ê°€ í•­ëª©: 10ê°œ
í‰ê°€ ì¼ì‹œ: 2025-01-15T10:30:00.000Z

ğŸ“ˆ ì „ì²´ ë©”íŠ¸ë¦­ (í‰ê· )
--------------------------------------------------------------------------------
  Faithfulness      : 0.85 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘
  Answer Relevancy  : 0.78 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘
  Context Precision : 0.72 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘
  Context Recall    : 0.80 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘

ğŸ“‹ ì§ˆë¬¸ ìœ í˜•ë³„ ë¶„ì„
--------------------------------------------------------------------------------
  factual     (2ê°œ): F=0.90 AR=0.85 CP=0.80 CR=0.85
  followup    (2ê°œ): F=0.82 AR=0.75 CP=0.70 CR=0.78
  procedural  (2ê°œ): F=0.88 AR=0.82 CP=0.75 CR=0.80
```

### ê¶Œì¥ ì ìˆ˜ ê¸°ì¤€

| ë©”íŠ¸ë¦­ | ìš°ìˆ˜ | ì–‘í˜¸ | ê°œì„  í•„ìš” |
|--------|------|------|-----------|
| Faithfulness | â‰¥ 0.9 | 0.7-0.9 | < 0.7 |
| Answer Relevancy | â‰¥ 0.85 | 0.7-0.85 | < 0.7 |
| Context Precision | â‰¥ 0.8 | 0.6-0.8 | < 0.6 |
| Context Recall | â‰¥ 0.8 | 0.6-0.8 | < 0.6 |

---

## ê°œì„  ê°€ì´ë“œ

### Faithfulnessê°€ ë‚®ì„ ë•Œ

**ì›ì¸**: í• ë£¨ì‹œë„¤ì´ì…˜, ì»¨í…ìŠ¤íŠ¸ ì™¸ ì •ë³´ ìƒì„±

**í•´ê²°ì±…**:
1. ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ì— "ì»¨í…ìŠ¤íŠ¸ì— ì—†ëŠ” ì •ë³´ëŠ” ì¶”ì¸¡í•˜ì§€ ë§ˆì„¸ìš”" ê°•ì¡°
2. Temperature ë‚®ì¶”ê¸° (í˜„ì¬ generator.tsì—ì„œ 0.3 ì‚¬ìš© ì¤‘)
3. ê²€ìƒ‰ í’ˆì§ˆ ê°œì„ ìœ¼ë¡œ ë” ê´€ë ¨ ìˆëŠ” ì»¨í…ìŠ¤íŠ¸ ì œê³µ

### Answer Relevancyê°€ ë‚®ì„ ë•Œ

**ì›ì¸**: ì§ˆë¬¸ ì˜ë„ íŒŒì•… ì‹¤íŒ¨, ë¶ˆí•„ìš”í•œ ì •ë³´ í¬í•¨

**í•´ê²°ì±…**:
1. Query Rewriting ë¡œì§ ê°œì„ 
2. ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ì—ì„œ "ì§ˆë¬¸ì— ì§ì ‘ ë‹µë³€í•˜ì„¸ìš”" ê°•ì¡°
3. ë‹µë³€ ê¸¸ì´ ì œí•œ ê³ ë ¤

### Context Precisionì´ ë‚®ì„ ë•Œ

**ì›ì¸**: ê²€ìƒ‰ ê²°ê³¼ì— ê´€ë ¨ ì—†ëŠ” ì²­í¬ ë‹¤ìˆ˜ í¬í•¨

**í•´ê²°ì±…**:
1. ì„ë² ë”© ëª¨ë¸ í’ˆì§ˆ ê²€í† 
2. Hybrid Search ê°€ì¤‘ì¹˜ ì¡°ì • (í˜„ì¬ vector 0.7, fulltext 0.3)
3. RRF K íŒŒë¼ë¯¸í„° ì¡°ì •
4. ì²­í¬ ì‚¬ì´ì¦ˆ ìµœì í™”

### Context Recallì´ ë‚®ì„ ë•Œ

**ì›ì¸**: í•„ìš”í•œ ì •ë³´ê°€ ê²€ìƒ‰ë˜ì§€ ì•ŠìŒ

**í•´ê²°ì±…**:
1. ê²€ìƒ‰ ì²­í¬ ìˆ˜(topK) ì¦ê°€
2. ë¬¸ì„œ ë¶„í•  ì „ëµ ì¬ê²€í† 
3. ë©”íƒ€ë°ì´í„° ê¸°ë°˜ í•„í„°ë§ ê°œì„ 
4. ë¬¸ì„œ ì—…ë°ì´íŠ¸ í•„ìš” ì—¬ë¶€ í™•ì¸

---

## ì•„í‚¤í…ì²˜

```
lib/rag/evaluation/
â”œâ”€â”€ index.ts              # ëª¨ë“ˆ ì§„ì…ì 
â”œâ”€â”€ types.ts              # íƒ€ì… ì •ì˜
â”œâ”€â”€ dataset.ts            # ë°ì´í„°ì…‹ ë¡œë”
â”œâ”€â”€ evaluator.ts          # í‰ê°€ ì—”ì§„
â”œâ”€â”€ reporter.ts           # ë¦¬í¬íŠ¸ ìƒì„±
â””â”€â”€ metrics/
    â”œâ”€â”€ index.ts
    â”œâ”€â”€ faithfulness.ts   # ì¶©ì‹¤ë„ ë©”íŠ¸ë¦­
    â”œâ”€â”€ answer-relevancy.ts
    â”œâ”€â”€ context-precision.ts
    â””â”€â”€ context-recall.ts

data/evaluation/
â”œâ”€â”€ sample-dataset.json   # ìƒ˜í”Œ ë°ì´í„°ì…‹
â””â”€â”€ README.md             # ë°ì´í„°ì…‹ ì‘ì„± ê°€ì´ë“œ

scripts/
â””â”€â”€ evaluate-rag.ts       # CLI ë„êµ¬
```

### ì˜ì¡´ì„±

í‰ê°€ ì‹œìŠ¤í…œì€ ê¸°ì¡´ RAG íŒŒì´í”„ë¼ì¸ì„ ê·¸ëŒ€ë¡œ í™œìš©í•©ë‹ˆë‹¤:

- `lib/rag/retrieval.ts` - `hybridSearch()` í•¨ìˆ˜
- `lib/rag/generator.ts` - `generateWithFallback()` í•¨ìˆ˜
- `lib/rag/query-rewriter.ts` - `rewriteQuery()` í•¨ìˆ˜

---

## FAQ

### Q: í‰ê°€ì— ì‚¬ìš©ë˜ëŠ” LLMì€?

ê¸°ë³¸ì ìœ¼ë¡œ `gemini-2.5-flash-lite`ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ê¸°ì¡´ `generateWithFallback` í•¨ìˆ˜ë¥¼ í†µí•´ ì‹¤í–‰ë˜ë¯€ë¡œ API í‚¤ ì„¤ì •ë§Œ ë˜ì–´ ìˆìœ¼ë©´ ë©ë‹ˆë‹¤.

### Q: í‰ê°€ ë¹„ìš©ì€?

10ê°œ í•­ëª© í‰ê°€ ì‹œ ì•½ 4ê°œ ë©”íŠ¸ë¦­ Ã— 10ê°œ = 40íšŒ LLM í˜¸ì¶œì´ ë°œìƒí•©ë‹ˆë‹¤. Gemini Flash-Liteì˜ ì €ë ´í•œ ë¹„ìš©ìœ¼ë¡œ ëŒ€ëŸ‰ í‰ê°€ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.

### Q: ìƒˆ ë©”íŠ¸ë¦­ì„ ì¶”ê°€í•˜ë ¤ë©´?

1. `lib/rag/evaluation/metrics/`ì— ìƒˆ íŒŒì¼ ìƒì„±
2. `MetricResult<T>` íƒ€ì…ìœ¼ë¡œ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜ êµ¬í˜„
3. `metrics/index.ts`ì—ì„œ export
4. `types.ts`ì˜ `MetricName`ì— ì¶”ê°€
5. `evaluator.ts`ì— í†µí•©

### Q: ì‹¤ì œ ì„œë¹„ìŠ¤ ë°ì´í„°ë¡œ í‰ê°€í•˜ë ¤ë©´?

1. ì‹¤ì œ ì‚¬ìš©ì ì§ˆë¬¸ì„ ìˆ˜ì§‘
2. ê° ì§ˆë¬¸ì— ëŒ€í•œ Ground Truth ì‘ì„±
3. ì ì ˆí•œ questionType ë¶„ë¥˜
4. JSON ë°ì´í„°ì…‹ìœ¼ë¡œ êµ¬ì„±
5. `pnpm rag:evaluate`ë¡œ ì‹¤í–‰

---

## ê´€ë ¨ ë¬¸ì„œ

- [RAG ì‹œìŠ¤í…œ ê°œìš”](./RAG_OVERVIEW.md)
- [Query Rewriting ê°€ì´ë“œ](./QUERY_REWRITING.md)
- [í‰ê°€ ë°ì´í„°ì…‹ ì‘ì„± ê°€ì´ë“œ](../data/evaluation/README.md)
