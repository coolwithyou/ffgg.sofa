# RAG 문서 전처리 Phase 1: 상세 설계서

## 목차
1. [프롬프트 설계](#1-프롬프트-설계)
2. [재구성 출력 스키마](#2-재구성-출력-스키마)
3. [위험 점수 기준](#3-위험-점수-기준)
4. [UI 와이어프레임](#4-ui-와이어프레임)

---

## 1. 프롬프트 설계

### 1.1 문서 재구성 프롬프트

#### 용도
원본 텍스트를 RAG에 최적화된 마크다운으로 재구성

#### 프롬프트

```
당신은 문서 구조화 전문가입니다. 주어진 원본 텍스트를 RAG 시스템에 최적화된 마크다운으로 재구성하세요.

## 재구성 원칙

1. **구조 명확화**: 암묵적인 섹션/그룹을 명시적 헤더로 표현
2. **맥락 보존**: 헤더와 내용의 관계가 끊어지지 않도록 유지
3. **정보 무손실**: 원본의 모든 정보가 재구성본에 포함되어야 함
4. **정규화**: 연락처, 날짜, 금액 등은 일관된 형식으로 통일

## 출력 형식

각 섹션에 대해 다음 형식을 따르세요:

```markdown
<!-- source: page {페이지}, line {시작}-{끝} -->
## {섹션 제목}

{내용}
```

## 특수 처리 규칙

### 연락처 목록
- 부서/그룹 헤더를 명시적으로 추가
- 각 연락처는 "이름: 전화번호 (이메일)" 형식으로 정규화
- 원본에서 분리되어 있어도 같은 그룹이면 하나의 섹션으로 통합

### 테이블
- 마크다운 테이블로 변환
- 헤더 행이 명확하지 않으면 추론하여 추가하고 주석으로 표시

### 정책/규정
- 조항 번호 체계 유지
- 참조 관계("위 조항", "상기 내용" 등)를 명시적 참조로 변환

## 주의사항

- 원본에 없는 정보를 추가하지 마세요
- 불확실한 해석이 필요한 경우 `[불확실: 원본 확인 필요]` 태그를 추가하세요
- 숫자, 날짜, 금액은 절대 변경하지 마세요

---

## 원본 텍스트

{원본_텍스트}

---

## 문서 메타데이터

- 파일명: {파일명}
- 총 페이지: {총_페이지}
- 문서 유형: {문서_유형}
```

---

### 1.2 Claim 추출 프롬프트

#### 용도
재구성된 문서에서 검증 가능한 사실적 주장(Claim)을 추출

#### 프롬프트

```
당신은 사실 검증 전문가입니다. 주어진 재구성 문서에서 검증 가능한 사실적 주장(Claim)을 추출하세요.

## Claim의 정의

검증 가능한 Claim이란:
- 구체적인 숫자, 날짜, 금액이 포함된 문장
- 특정 사람/부서/조직의 연락처 정보
- 정책의 구체적 조건 (기간, 금액, 자격 등)
- 명확한 사실 관계 (소속, 직책, 위치 등)

## Claim이 아닌 것

- 일반적인 설명이나 개요
- 주관적 표현
- 구체적 수치 없는 서술

## 출력 형식

JSON 배열로 출력하세요:

```json
[
  {
    "claim_id": "C001",
    "claim_text": "마케팅팀 연락처는 총 30개이다",
    "claim_type": "count",
    "entities": ["마케팅팀", "30"],
    "source_section": "## 마케팅팀 연락처",
    "source_line": 15,
    "risk_level": "high",
    "risk_reason": "숫자 정확성 검증 필요"
  }
]
```

## Claim 유형 (claim_type)

- `contact`: 연락처 정보 (전화번호, 이메일)
- `count`: 수량/개수
- `date`: 날짜/기간
- `amount`: 금액
- `policy`: 정책/규정 조건
- `relation`: 소속/관계 정보
- `other`: 기타 사실적 주장

## Risk Level 판정 기준

- `high`: 숫자, 연락처, 금액, 정책 조건
- `medium`: 날짜, 소속 관계
- `low`: 기타 사실적 주장

---

## 재구성 문서

{재구성_문서}
```

---

### 1.3 Claim 검증 프롬프트

#### 용도
추출된 Claim을 원본 문서와 비교하여 검증

#### 프롬프트

```
당신은 문서 검증 전문가입니다. 주어진 Claim이 원본 문서에서 지지되는지 검증하세요.

## 검증 대상 Claim

{claim_json}

## 원본 문서

{원본_문서}

## 검증 작업

1. 원본에서 해당 Claim을 지지하는 근거를 찾으세요
2. 근거의 정확한 위치(페이지, 라인)를 기록하세요
3. 판정을 내리세요

## 판정 기준

- `SUPPORTED`: 원본에서 동일한 정보를 확인할 수 있음
- `CONTRADICTED`: 원본의 정보와 Claim이 충돌함
- `NOT_FOUND`: 원본에서 관련 정보를 찾을 수 없음
- `MODIFIED`: 정보는 있으나 형식/표현이 변경됨 (내용은 동일)

## 출력 형식

```json
{
  "claim_id": "C001",
  "verdict": "SUPPORTED",
  "confidence": 0.95,
  "evidence": {
    "text": "마케팅팀 담당자 목록 (30명)",
    "page": 3,
    "line_start": 45,
    "line_end": 47
  },
  "discrepancy": null,
  "note": "원본에서 '30명'으로 명시됨"
}
```

## CONTRADICTED인 경우

```json
{
  "claim_id": "C002",
  "verdict": "CONTRADICTED",
  "confidence": 0.98,
  "evidence": {
    "text": "김철수 010-1234-5678",
    "page": 3,
    "line_start": 52,
    "line_end": 52
  },
  "discrepancy": {
    "claim_value": "010-1234-5679",
    "original_value": "010-1234-5678",
    "type": "digit_mismatch"
  },
  "note": "전화번호 마지막 자리 불일치"
}
```
```

---

### 1.4 의심 항목 요약 프롬프트

#### 용도
검증 결과를 사용자 친화적인 요약으로 변환

#### 프롬프트

```
당신은 QA 리포트 작성 전문가입니다. Claim 검증 결과를 사용자가 빠르게 검토할 수 있는 요약 리포트로 작성하세요.

## 검증 결과

{검증_결과_json_배열}

## 출력 형식

### 요약

- 총 검증 항목: {N}개
- ✅ 확인됨 (SUPPORTED): {n1}개
- ⚠️ 불일치 (CONTRADICTED): {n2}개
- ❓ 미확인 (NOT_FOUND): {n3}개
- 🔄 형식 변경 (MODIFIED): {n4}개

### 🚨 필수 검토 항목 (High Risk + 문제 발견)

| # | 항목 | 문제 | 원본 위치 | 조치 |
|---|------|------|-----------|------|
| 1 | {claim 요약} | {불일치 내용} | p{N}, L{M} | [확인] |

### ⚠️ 권장 검토 항목 (Medium Risk 또는 NOT_FOUND)

...

### ✅ 자동 승인 가능 항목

{n}개 항목이 원본과 일치합니다. [모두 승인]

## 작성 원칙

1. 사용자가 5분 내에 검토 완료할 수 있도록 핵심만
2. 필수 검토 항목은 10개 이내로 제한 (초과 시 가장 위험한 것만)
3. 구체적인 불일치 내용을 명시 (예: "5678 → 5679")
4. 원본 위치를 클릭 가능한 형태로 제공
```

---

## 2. 재구성 출력 스키마

### 2.1 공통 스키마

```typescript
interface ReconstructedDocument {
  metadata: DocumentMetadata;
  sections: Section[];
  claims: Claim[];
  validation_report: ValidationReport;
}

interface DocumentMetadata {
  original_filename: string;
  document_type: DocumentType;
  total_pages: number;
  reconstruction_model: string;
  reconstruction_timestamp: string;
  confidence_score: number;  // 0-1, 전체 문서의 재구성 신뢰도
}

type DocumentType = 
  | 'contact_list'      // 연락처 목록
  | 'policy'            // 정책/규정
  | 'faq'               // FAQ
  | 'manual'            // 매뉴얼/가이드
  | 'meeting_notes'     // 회의록
  | 'general';          // 일반 문서

interface Section {
  section_id: string;
  title: string;
  content: string;          // 마크다운 형식
  source_reference: SourceReference;
  subsections?: Section[];
}

interface SourceReference {
  page: number;
  line_start: number;
  line_end: number;
  confidence: number;       // 매핑 신뢰도
}
```

### 2.2 연락처 목록 스키마

```typescript
interface ContactListDocument extends ReconstructedDocument {
  document_type: 'contact_list';
  contacts: ContactGroup[];
}

interface ContactGroup {
  group_id: string;
  group_name: string;           // 예: "마케팅팀", "영업1팀"
  parent_group?: string;        // 상위 그룹 ID
  contacts: Contact[];
  source_reference: SourceReference;
}

interface Contact {
  contact_id: string;
  name: string;
  phone?: string;               // 정규화된 형식: 010-1234-5678
  email?: string;
  position?: string;            // 직책
  department?: string;          // 부서 (group과 다를 경우)
  source_reference: SourceReference;
}
```

**연락처 마크다운 출력 예시:**

```markdown
<!-- source: page 3, line 15-45 -->
## 마케팅팀 연락처

| 이름 | 전화번호 | 이메일 | 직책 |
|------|----------|--------|------|
| 김철수 | 010-1234-5678 | kim@company.com | 팀장 |
| 박영희 | 010-2345-6789 | park@company.com | 대리 |
| 이민수 | 010-3456-7890 | lee@company.com | 사원 |

**총 인원: 3명**
```

### 2.3 정책/규정 스키마

```typescript
interface PolicyDocument extends ReconstructedDocument {
  document_type: 'policy';
  policy_info: PolicyInfo;
  articles: Article[];
}

interface PolicyInfo {
  policy_name: string;
  effective_date?: string;
  version?: string;
  department?: string;
}

interface Article {
  article_id: string;
  article_number: string;       // 예: "제3조", "3.1"
  title: string;
  content: string;
  sub_articles?: Article[];
  references?: ArticleReference[];  // 다른 조항 참조
  conditions?: PolicyCondition[];
  source_reference: SourceReference;
}

interface PolicyCondition {
  condition_type: 'duration' | 'amount' | 'eligibility' | 'exception';
  description: string;
  value?: string | number;
  unit?: string;
}

interface ArticleReference {
  reference_text: string;       // "제2조에 따라"
  target_article_id: string;
}
```

**정책 마크다운 출력 예시:**

```markdown
<!-- source: page 1, line 1-5 -->
# 휴가 규정

- **시행일**: 2024년 1월 1일
- **버전**: v2.1
- **관리부서**: 인사팀

---

<!-- source: page 1, line 10-25 -->
## 제1조 (목적)

이 규정은 회사 임직원의 휴가에 관한 사항을 정함을 목적으로 한다.

---

<!-- source: page 2, line 1-30 -->
## 제2조 (연차휴가)

1. 1년간 80% 이상 출근한 직원에게 15일의 유급휴가를 부여한다.
2. 3년 이상 근속 시 매 2년마다 1일씩 가산한다. (최대 25일)

**[조건]**
- 기간: 1년
- 출근율: 80% 이상
- 기본 일수: 15일
- 최대 일수: 25일
```

### 2.4 FAQ 스키마

```typescript
interface FAQDocument extends ReconstructedDocument {
  document_type: 'faq';
  categories: FAQCategory[];
}

interface FAQCategory {
  category_id: string;
  category_name: string;
  faqs: FAQItem[];
}

interface FAQItem {
  faq_id: string;
  question: string;
  answer: string;
  keywords: string[];           // 검색 최적화용
  related_faqs?: string[];      // 관련 FAQ ID
  source_reference: SourceReference;
}
```

**FAQ 마크다운 출력 예시:**

```markdown
<!-- source: page 5, line 1-50 -->
## 배송 관련 FAQ

### Q1. 배송은 얼마나 걸리나요?

**A.** 일반 배송은 결제 완료 후 2-3일 (영업일 기준) 소요됩니다. 
제주/도서산간 지역은 1-2일 추가될 수 있습니다.

**키워드**: 배송, 배송기간, 소요시간

---

### Q2. 배송 조회는 어떻게 하나요?

**A.** 마이페이지 > 주문내역에서 확인 가능합니다.
송장번호 클릭 시 택배사 조회 페이지로 이동합니다.

**키워드**: 배송조회, 송장, 택배
```

---

## 3. 위험 점수 기준

### 3.1 Risk Level 정의

| Level | 설명 | 필수 검토 | 자동 승인 |
|-------|------|-----------|-----------|
| **CRITICAL** | 오류 시 법적/재무적 영향 | ✅ 필수 | ❌ 불가 |
| **HIGH** | 오류 시 업무 차질 | ✅ 필수 | ❌ 불가 |
| **MEDIUM** | 오류 시 불편/혼란 | 권장 | 조건부 가능 |
| **LOW** | 오류 영향 미미 | 선택 | ✅ 가능 |

### 3.2 Claim 유형별 기본 Risk Level

```typescript
const CLAIM_TYPE_RISK: Record<ClaimType, RiskLevel> = {
  // CRITICAL
  'bank_account': 'critical',      // 계좌번호
  'contract_amount': 'critical',   // 계약 금액
  'legal_clause': 'critical',      // 법적 조항
  
  // HIGH
  'contact_phone': 'high',         // 전화번호
  'contact_email': 'high',         // 이메일
  'policy_condition': 'high',      // 정책 조건 (기간, 자격 등)
  'count': 'high',                 // 수량/개수
  'price': 'high',                 // 가격
  
  // MEDIUM
  'date': 'medium',                // 날짜
  'person_name': 'medium',         // 인명
  'organization': 'medium',        // 조직명
  'relation': 'medium',            // 소속 관계
  
  // LOW
  'description': 'low',            // 일반 설명
  'keyword': 'low',                // 키워드
  'category': 'low',               // 분류
};
```

### 3.3 검증 결과별 Risk 조정

```typescript
function adjustRisk(
  baseRisk: RiskLevel, 
  verdict: Verdict
): RiskLevel {
  const riskMatrix = {
    'SUPPORTED': -1,      // 위험도 1단계 하향
    'MODIFIED': 0,        // 유지
    'NOT_FOUND': +1,      // 위험도 1단계 상향
    'CONTRADICTED': +2,   // 위험도 2단계 상향 (최대 CRITICAL)
  };
  
  return applyRiskAdjustment(baseRisk, riskMatrix[verdict]);
}
```

### 3.4 패턴 기반 자동 검출 규칙

#### 전화번호 검증

```typescript
const PHONE_PATTERNS = {
  mobile: /^01[0-9]-\d{4}-\d{4}$/,
  landline: /^0[2-6][0-9]?-\d{3,4}-\d{4}$/,
  toll_free: /^(080|1544|1566|1577|1588|1644|1666)-\d{4}$/,
};

function validatePhone(original: string, reconstructed: string): ValidationResult {
  // 숫자만 추출하여 비교
  const origDigits = original.replace(/\D/g, '');
  const reconDigits = reconstructed.replace(/\D/g, '');
  
  if (origDigits === reconDigits) {
    return { verdict: 'SUPPORTED', confidence: 1.0 };
  }
  
  // Levenshtein distance로 유사도 계산
  const distance = levenshtein(origDigits, reconDigits);
  if (distance === 1) {
    return { 
      verdict: 'CONTRADICTED', 
      confidence: 0.95,
      discrepancy: { type: 'single_digit_error', distance }
    };
  }
  
  return { verdict: 'CONTRADICTED', confidence: 0.9 };
}
```

#### 이메일 검증

```typescript
function validateEmail(original: string, reconstructed: string): ValidationResult {
  const origLower = original.toLowerCase().trim();
  const reconLower = reconstructed.toLowerCase().trim();
  
  if (origLower === reconLower) {
    return { verdict: 'SUPPORTED', confidence: 1.0 };
  }
  
  // @ 기준으로 분리하여 부분 비교
  const [origLocal, origDomain] = origLower.split('@');
  const [reconLocal, reconDomain] = reconLower.split('@');
  
  if (origDomain !== reconDomain) {
    return { 
      verdict: 'CONTRADICTED', 
      confidence: 0.98,
      discrepancy: { type: 'domain_mismatch' }
    };
  }
  
  return { 
    verdict: 'CONTRADICTED', 
    confidence: 0.95,
    discrepancy: { type: 'local_part_mismatch' }
  };
}
```

#### 금액 검증

```typescript
function validateAmount(original: string, reconstructed: string): ValidationResult {
  // 숫자와 단위 분리
  const origAmount = parseAmount(original);   // { value: 1000000, unit: '원' }
  const reconAmount = parseAmount(reconstructed);
  
  if (origAmount.value === reconAmount.value && origAmount.unit === reconAmount.unit) {
    return { verdict: 'SUPPORTED', confidence: 1.0 };
  }
  
  // 단위 변환 체크 (천원 ↔ 원, 만원 ↔ 원)
  if (isEquivalentAmount(origAmount, reconAmount)) {
    return { verdict: 'MODIFIED', confidence: 0.9, note: '단위 표기 변경' };
  }
  
  return { 
    verdict: 'CONTRADICTED', 
    confidence: 0.98,
    discrepancy: { 
      original_value: origAmount.value,
      reconstructed_value: reconAmount.value 
    }
  };
}
```

### 3.5 복합 Risk 계산

```typescript
interface RiskScore {
  level: RiskLevel;
  score: number;          // 0-100
  factors: RiskFactor[];
}

interface RiskFactor {
  factor: string;
  weight: number;
  value: number;
}

function calculateRiskScore(claim: Claim, validation: ValidationResult): RiskScore {
  const factors: RiskFactor[] = [
    {
      factor: 'claim_type_base',
      weight: 0.3,
      value: CLAIM_TYPE_RISK_SCORE[claim.claim_type]
    },
    {
      factor: 'verdict_adjustment',
      weight: 0.4,
      value: VERDICT_RISK_SCORE[validation.verdict]
    },
    {
      factor: 'confidence_inverse',
      weight: 0.2,
      value: (1 - validation.confidence) * 100
    },
    {
      factor: 'entity_sensitivity',
      weight: 0.1,
      value: calculateEntitySensitivity(claim.entities)
    }
  ];
  
  const score = factors.reduce((sum, f) => sum + f.weight * f.value, 0);
  
  return {
    level: scoreToLevel(score),
    score,
    factors
  };
}
```

---

## 4. UI 와이어프레임

### 4.1 전체 레이아웃

```
┌──────────────────────────────────────────────────────────────────────────────┐
│ 📄 문서 검증: 마케팅팀_연락처_2024.pdf                    [저장] [취소]       │
├──────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌─ 검증 요약 ─────────────────────────────────────────────────────────────┐ │
│  │ 총 45개 항목 검증 완료                                                  │ │
│  │ ✅ 38개 확인  ⚠️ 5개 불일치  ❓ 2개 미확인                              │ │
│  │                                                                         │ │
│  │ [🚨 필수 검토 5개]  [⚠️ 권장 검토 2개]  [✅ 전체 보기]                   │ │
│  └─────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
├────────────────────────────────┬─────────────────────────────────────────────┤
│         원본 문서               │            재구성 문서 (편집 가능)           │
│                                │                                             │
│  ┌──────────────────────────┐  │  ┌───────────────────────────────────────┐  │
│  │                          │  │  │ ## 마케팅팀 연락처                    │  │
│  │   [PDF 뷰어]             │  │  │                                       │  │
│  │                          │  │  │ | 이름 | 전화번호 | 이메일 |          │  │
│  │   마케팅팀 연락처         │  │  │ |------|----------|--------|          │  │
│  │   김철수 010-1234-5678   │  │  │ | 김철수 | 010-1234-5679 ⚠️ | ...   │  │
│  │   park@company.com       │  │  │ | 박영희 | 010-2345-6789 | ...      │  │
│  │                          │  │  │                                       │  │
│  │   [하이라이트 영역]       │  │  │ **총 인원: 30명** ⚠️                  │  │
│  │                          │  │  │                                       │  │
│  └──────────────────────────┘  │  └───────────────────────────────────────┘  │
│                                │                                             │
│  Page 3 of 12  [◀] [▶]        │  Section 2 of 5   [편집 모드 ON]            │
│                                │                                             │
├────────────────────────────────┴─────────────────────────────────────────────┤
│                                                                              │
│  ┌─ 검증 항목 리스트 ───────────────────────────────────────────────────────┐ │
│  │                                                                         │ │
│  │  [필터: 🔴 불일치만 ▼]  [정렬: 위험도순 ▼]  [검색: ________]            │ │
│  │                                                                         │ │
│  │  ┌─────────────────────────────────────────────────────────────────┐   │ │
│  │  │ 🔴 HIGH | 전화번호 불일치                                       │   │ │
│  │  │ Claim: "김철수 전화번호는 010-1234-5679"                        │   │ │
│  │  │ 원본: 010-1234-5678 (p3, L15)                                   │   │ │
│  │  │ 차이: 마지막 자리 8 → 9                                         │   │ │
│  │  │                                     [원본 보기] [수정] [승인] ☐ │   │ │
│  │  └─────────────────────────────────────────────────────────────────┘   │ │
│  │                                                                         │ │
│  │  ┌─────────────────────────────────────────────────────────────────┐   │ │
│  │  │ 🔴 HIGH | 인원 수 불일치                                        │   │ │
│  │  │ Claim: "마케팅팀 총 인원은 30명"                                │   │ │
│  │  │ 원본: 28명 (p3, L45)                                            │   │ │
│  │  │                                     [원본 보기] [수정] [승인] ☐ │   │ │
│  │  └─────────────────────────────────────────────────────────────────┘   │ │
│  │                                                                         │ │
│  │  [더 보기 (3개 남음)]                                                   │ │
│  └─────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
├──────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│   ☐ 필수 검토 항목 5개를 모두 확인했습니다                                    │
│                                                                              │
│   [검증 완료 및 저장]  [임시 저장]  [취소]                                     │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
```

### 4.2 컴포넌트 상세

#### 4.2.1 검증 요약 카드

```
┌─────────────────────────────────────────────────────────────────┐
│ 📊 검증 요약                                                    │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐              │
│   │   38    │ │    5    │ │    2    │ │    0    │              │
│   │   ✅    │ │   ⚠️    │ │   ❓    │ │   🔄    │              │
│   │ 확인됨  │ │ 불일치  │ │ 미확인  │ │ 변경됨  │              │
│   └─────────┘ └─────────┘ └─────────┘ └─────────┘              │
│                                                                 │
│   신뢰도 점수: ████████░░ 82%                                   │
│                                                                 │
│   [🚨 필수 검토 (5)]  [⚠️ 권장 검토 (2)]  [모두 보기 (45)]      │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

#### 4.2.2 검증 항목 카드 (확장 상태)

```
┌─────────────────────────────────────────────────────────────────┐
│ 🔴 HIGH  │  전화번호 불일치  │  contact_phone         [▼ 접기] │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  📝 Claim                                                       │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 김철수의 전화번호는 010-1234-5679 이다                   │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  📄 원본 근거                                                   │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ "김철수 010-1234-5678"                                   │   │
│  │ 📍 Page 3, Line 15                          [바로가기 →] │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ⚠️ 불일치 상세                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 위치: 마지막 자리                                        │   │
│  │ 원본 값:    010-1234-567[8]                              │   │
│  │ 재구성 값:  010-1234-567[9]                              │   │
│  │ 유형: single_digit_error                                 │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  🔧 조치                                                        │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 수정할 값: [010-1234-5678          ]  [원본 값으로 복원] │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│             [수정 적용]  [이 항목 무시]  [승인 ☐]               │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

#### 4.2.3 원본-재구성 동기 하이라이트

```
사용자 액션: 검증 항목 카드에서 [원본 보기] 클릭

┌─────────────────────────────┐    ┌─────────────────────────────┐
│ 원본 문서                    │    │ 재구성 문서                  │
├─────────────────────────────┤    ├─────────────────────────────┤
│                             │    │                             │
│ 마케팅팀 연락처              │    │ ## 마케팅팀 연락처          │
│                             │    │                             │
│ ┌─────────────────────────┐ │    │ | 이름 | 전화번호 |         │
│ │░░░░░░░░░░░░░░░░░░░░░░░░░│ │    │ |------|----------|         │
│ │░ 김철수 010-1234-5678  ░│◄├────┼►| 김철수 | ░░░░░░░░░░░ |    │
│ │░░░░░░░░░░░░░░░░░░░░░░░░░│ │    │ |        | 010-1234-5679 |  │
│ └─────────────────────────┘ │    │                             │
│ 박영희 010-2345-6789       │    │ | 박영희 | 010-2345-6789 |  │
│                             │    │                             │
└─────────────────────────────┘    └─────────────────────────────┘

[░░░ 하이라이트된 영역: 해당 Claim의 근거 위치 ░░░]
```

### 4.3 인터랙션 플로우

#### 4.3.1 기본 검토 플로우

```
┌─────────────────────────────────────────────────────────────────┐
│                         검토 시작                                │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│               검증 요약 확인 (전체 현황 파악)                     │
│                                                                 │
│   • 필수 검토 항목 수 확인                                       │
│   • 전체 신뢰도 점수 확인                                        │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                [🚨 필수 검토] 탭 클릭                            │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
          ┌───────────────────┴───────────────────┐
          │                                       │
          ▼                                       ▼
┌─────────────────────┐               ┌─────────────────────┐
│  항목 카드 확장      │               │  [원본 보기] 클릭    │
│  상세 내용 확인      │               │  좌측 패널 스크롤    │
└─────────────────────┘               │  하이라이트 표시     │
          │                           └─────────────────────┘
          │                                       │
          └───────────────────┬───────────────────┘
                              │
                              ▼
          ┌───────────────────┴───────────────────┐
          │                                       │
          ▼                                       ▼
┌─────────────────────┐               ┌─────────────────────┐
│  불일치 확인됨       │               │  오류 아님 (원본이   │
│  [수정 적용] 클릭    │               │  잘못됨 또는 의도적) │
│                     │               │  [이 항목 무시]      │
└─────────────────────┘               └─────────────────────┘
          │                                       │
          └───────────────────┬───────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                      [승인 ☐] 체크                               │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│            모든 필수 항목 승인 완료?                              │
│                                                                 │
│            YES → [검증 완료 및 저장] 활성화                       │
│            NO  → 다음 필수 항목으로 이동                          │
└─────────────────────────────────────────────────────────────────┘
```

#### 4.3.2 빠른 검토 플로우 (신뢰도 높은 경우)

```
┌─────────────────────────────────────────────────────────────────┐
│  검증 요약: 신뢰도 95%, 필수 검토 0개                            │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   🎉 모든 항목이 원본과 일치합니다!                              │
│                                                                 │
│   ┌─────────────────────────────────────────────────────────┐   │
│   │ ☐ 자동 검증 결과를 확인했으며, 재구성 문서를 승인합니다  │   │
│   └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│   [상세 보기]  [바로 저장]                                       │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 4.4 반응형 고려사항

#### 모바일 (< 768px)

```
┌─────────────────────────┐
│ 📄 문서 검증            │
├─────────────────────────┤
│ [원본] [재구성] [검증]  │  ← 탭으로 전환
├─────────────────────────┤
│                         │
│   현재 선택된 뷰        │
│                         │
│                         │
│                         │
├─────────────────────────┤
│ 🚨 필수 검토: 5개       │
│ [검토 시작 →]           │
└─────────────────────────┘
```

#### 태블릿 (768px - 1024px)

- 좌우 패널 50:50 유지
- 검증 리스트는 하단 시트로 표시
- 스와이프로 항목 간 이동

---

## 5. 구현 체크리스트

### Phase 1 (MVP) 체크리스트

#### 백엔드
- [ ] 문서 재구성 API 엔드포인트
- [ ] Claim 추출 파이프라인
- [ ] 기본 검증 로직 (전화번호, 이메일, 숫자)
- [ ] 검증 결과 저장 스키마

#### 프론트엔드
- [ ] 듀얼 뷰어 레이아웃
- [ ] PDF 뷰어 통합
- [ ] 마크다운 에디터 통합
- [ ] 검증 요약 카드
- [ ] 검증 항목 리스트
- [ ] 근거 점프 기능
- [ ] 승인 체크박스 및 저장 플로우

#### 프롬프트
- [ ] 문서 재구성 프롬프트 테스트 및 튜닝
- [ ] Claim 추출 프롬프트 테스트 및 튜닝
- [ ] 검증 프롬프트 테스트 및 튜닝

### 테스트 케이스

| 케이스 | 입력 | 기대 결과 |
|--------|------|-----------|
| 정상 연락처 | 원본과 동일한 연락처 | SUPPORTED, confidence 1.0 |
| 숫자 오류 | 전화번호 1자리 다름 | CONTRADICTED, HIGH risk |
| 누락 | 원본에 있는 연락처 없음 | NOT_FOUND, HIGH risk |
| 형식 변경 | 010.1234.5678 → 010-1234-5678 | MODIFIED, LOW risk |
| 추가 정보 | 원본에 없는 내용 | CONTRADICTED (환각), CRITICAL |

---

*문서 버전: 1.0*
*작성일: 2026-01-11*
*다음 업데이트: Phase 1 구현 후 피드백 반영*